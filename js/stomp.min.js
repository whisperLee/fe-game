(function(){var f,e,b,d,a={}.hasOwnProperty,c=[].slice;f={LF:"\x0A",NULL:"\x00"};b=(function(){var g;function h(k,j,i){this.command=k;this.headers=j!=null?j:{};this.body=i!=null?i:""}h.prototype.toString=function(){var i,j,m,l,k;i=[this.command];m=this.headers["content-length"]===false?true:false;if(m){delete this.headers["content-length"]}k=this.headers;for(j in k){if(!a.call(k,j)){continue}l=k[j];i.push(""+j+":"+l)}if(this.body&&!m){i.push("content-length:"+(h.sizeOfUTF8(this.body)))}i.push(f.LF+this.body);return i.join(f.LF)};h.sizeOfUTF8=function(i){if(i){return encodeURI(i).match(/%..|./g).length}else{return 0}};g=function(A){var r,v,n,t,u,l,w,s,y,q,o,x,k,j,z,p,m;t=A.search(RegExp(""+f.LF+f.LF));u=A.substring(0,t).split(f.LF);n=u.shift();l={};x=function(i){return i.replace(/^\s+|\s+$/g,"")};p=u.reverse();for(k=0,z=p.length;k<z;k++){q=p[k];s=q.indexOf(":");l[x(q.substring(0,s))]=x(q.substring(s+1))}r="";o=t+2;if(l["content-length"]){y=parseInt(l["content-length"]);r=(""+A).substring(o,o+y)}else{v=null;for(w=j=o,m=A.length;o<=m?j<m:j>m;w=o<=m?++j:--j){v=A.charAt(w);if(v===f.NULL){break}r+=v}}return new h(n,l,r)};h.unmarshall=function(i){var j;return(function(){var n,l,m,k;m=i.split(RegExp(""+f.NULL+f.LF+"*"));k=[];for(n=0,l=m.length;n<l;n++){j=m[n];if((j!=null?j.length:void 0)>0){k.push(g(j))}}return k})()};h.marshall=function(l,k,i){var j;j=new h(l,k,i);return j.toString()+f.NULL};return h})();e=(function(){var g;function h(i){this.ws=i;this.ws.binaryType="arraybuffer";this.counter=0;this.connected=false;this.heartbeat={outgoing:10000,incoming:10000};this.maxWebSocketFrameSize=16*1024;this.subscriptions={}}h.prototype.debug=function(i){var j;return typeof window!=="undefined"&&window!==null?(j=window.console)!=null?j.log(i):void 0:void 0};g=function(){if(Date.now){return Date.now()}else{return new Date().valueOf}};h.prototype._transmit=function(l,k,i){var j;j=b.marshall(l,k,i);if(typeof this.debug==="function"){this.debug(">>> "+j)}while(true){if(j.length>this.maxWebSocketFrameSize){this.ws.send(j.substring(0,this.maxWebSocketFrameSize));j=j.substring(this.maxWebSocketFrameSize);if(typeof this.debug==="function"){this.debug("remaining = "+j.length)}}else{return this.ws.send(j)}}};h.prototype._setupHeartbeat=function(o){var n,k,j,l,m,i;if((m=o.version)!==d.VERSIONS.V1_1&&m!==d.VERSIONS.V1_2){return}i=(function(){var s,r,p,q;p=o["heart-beat"].split(",");q=[];for(s=0,r=p.length;s<r;s++){l=p[s];q.push(parseInt(l))}return q})(),k=i[0],n=i[1];if(!(this.heartbeat.outgoing===0||n===0)){j=Math.max(this.heartbeat.outgoing,n);if(typeof this.debug==="function"){this.debug("send PING every "+j+"ms")}this.pinger=d.setInterval(j,(function(p){return function(){p.ws.send(f.LF);return typeof p.debug==="function"?p.debug(">>> PING"):void 0}})(this))}if(!(this.heartbeat.incoming===0||k===0)){j=Math.max(this.heartbeat.incoming,k);if(typeof this.debug==="function"){this.debug("check PONG every "+j+"ms")}return this.ponger=d.setInterval(j,(function(p){return function(){var q;q=g()-p.serverActivity;if(q>j*2){if(typeof p.debug==="function"){p.debug("did not receive server activity for the last "+q+"ms")}return p.ws.close()}}})(this))}};h.prototype._parseConnect=function(){var k,i,j,l;k=1<=arguments.length?c.call(arguments,0):[];l={};switch(k.length){case 2:l=k[0],i=k[1];break;case 3:if(k[1] instanceof Function){l=k[0],i=k[1],j=k[2]}else{l.login=k[0],l.passcode=k[1],i=k[2]}break;case 4:l.login=k[0],l.passcode=k[1],i=k[2],j=k[3];break;default:l.login=k[0],l.passcode=k[1],i=k[2],j=k[3],l.host=k[4]}return[l,i,j]};h.prototype.connect=function(){var k,i,l,j;k=1<=arguments.length?c.call(arguments,0):[];j=this._parseConnect.apply(this,k);l=j[0],this.connectCallback=j[1],i=j[2];if(typeof this.debug==="function"){this.debug("Opening Web Socket...")}this.ws.onmessage=(function(m){return function(y){var u,w,p,t,o,n,v,z,r,x,s,q;t=typeof ArrayBuffer!=="undefined"&&y.data instanceof ArrayBuffer?(u=new Uint8Array(y.data),typeof m.debug==="function"?m.debug("--- got data length: "+u.length):void 0,((function(){var C,B,A;A=[];for(C=0,B=u.length;C<B;C++){w=u[C];A.push(String.fromCharCode(w))}return A})()).join("")):y.data;m.serverActivity=g();if(t===f.LF){if(typeof m.debug==="function"){m.debug("<<< PONG")}return}if(typeof m.debug==="function"){m.debug("<<< "+t)}s=b.unmarshall(t);q=[];for(r=0,x=s.length;r<x;r++){o=s[r];switch(o.command){case"CONNECTED":if(typeof m.debug==="function"){m.debug("connected to server "+o.headers.server)}m.connected=true;m._setupHeartbeat(o.headers);q.push(typeof m.connectCallback==="function"?m.connectCallback(o):void 0);break;case"MESSAGE":z=o.headers.subscription;v=m.subscriptions[z]||m.onreceive;if(v){p=m;n=o.headers["message-id"];o.ack=function(A){if(A==null){A={}}return p.ack(n,z,A)};o.nack=function(A){if(A==null){A={}}return p.nack(n,z,A)};q.push(v(o))}else{q.push(typeof m.debug==="function"?m.debug("Unhandled received MESSAGE: "+o):void 0)}break;case"RECEIPT":q.push(typeof m.onreceipt==="function"?m.onreceipt(o):void 0);break;case"ERROR":q.push(typeof i==="function"?i(o):void 0);break;default:q.push(typeof m.debug==="function"?m.debug("Unhandled frame: "+o):void 0)}}return q}})(this);this.ws.onclose=(function(m){return function(){var n;n="Whoops! Lost connection to "+m.ws.url;if(typeof m.debug==="function"){m.debug(n)}m._cleanUp();return typeof i==="function"?i(n):void 0}})(this);return this.ws.onopen=(function(m){return function(){if(typeof m.debug==="function"){m.debug("Web Socket Opened...")}l["accept-version"]=d.VERSIONS.supportedVersions();l["heart-beat"]=[m.heartbeat.outgoing,m.heartbeat.incoming].join(",");return m._transmit("CONNECT",l)}})(this)};h.prototype.disconnect=function(j,i){if(i==null){i={}}this._transmit("DISCONNECT",i);this.ws.onclose=null;this.ws.close();this._cleanUp();return typeof j==="function"?j():void 0};h.prototype._cleanUp=function(){this.connected=false;if(this.pinger){d.clearInterval(this.pinger)}if(this.ponger){return d.clearInterval(this.ponger)}};h.prototype.send=function(j,k,i){if(k==null){k={}}if(i==null){i=""}k.destination=j;return this._transmit("SEND",k,i)};h.prototype.subscribe=function(i,l,k){var j;if(k==null){k={}}if(!k.id){k.id="sub-"+this.counter++}k.destination=i;this.subscriptions[k.id]=l;this._transmit("SUBSCRIBE",k);j=this;return{id:k.id,unsubscribe:function(){return j.unsubscribe(k.id)}}};h.prototype.unsubscribe=function(i){delete this.subscriptions[i];return this._transmit("UNSUBSCRIBE",{id:i})};h.prototype.begin=function(k){var i,j;j=k||"tx-"+this.counter++;this._transmit("BEGIN",{transaction:j});i=this;return{id:j,commit:function(){return i.commit(j)},abort:function(){return i.abort(j)}}};h.prototype.commit=function(i){return this._transmit("COMMIT",{transaction:i})};h.prototype.abort=function(i){return this._transmit("ABORT",{transaction:i})};h.prototype.ack=function(i,j,k){if(k==null){k={}}k["message-id"]=i;k.subscription=j;return this._transmit("ACK",k)};h.prototype.nack=function(i,j,k){if(k==null){k={}}k["message-id"]=i;k.subscription=j;return this._transmit("NACK",k)};return h})();d={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(i,j){var g,h;if(j==null){j=["v10.stomp","v11.stomp"]}g=d.WebSocketClass||WebSocket;h=new g(i,j);return new e(h)},over:function(g){return new e(g)},Frame:b};if(typeof exports!=="undefined"&&exports!==null){exports.Stomp=d}if(typeof window!=="undefined"&&window!==null){d.setInterval=function(g,h){return window.setInterval(h,g)};d.clearInterval=function(g){return window.clearInterval(g)};window.Stomp=d}else{if(!exports){self.Stomp=d}}}).call(this);