new Vue({el:"#game",data:{flow:-1,combinats:[{name:"标准",content:{combination:[]}},{name:"娱乐",content:{identity:{},total:0,min:9,max:15}}],comType:-1,total:0,selfs:["全自助","半自助","手工"],victory:["屠城","屠边"],postData:{combinationId:0,config:{},gameModule:0,playerCount:0,type:0,userToken:"101"}},created:function(){var a=this;a.boxId=global.urlHash().boxId;a.gameNumber=global.urlHash().gameNumber;if(a.boxId){a.flow=0;a.getAllCombination();a.getAllIdentity()}else{global.pop_tips("房间号有误，请重新入座")}},methods:{getAllCombination:function(){var a=this;var b={url:"game/play/getAllCombination",data:{prefabricateFlag:true},success:function(j){if(j.status.code==="OK"){var c=j.data.dataList;var h=[];for(var g=0;g<c.length;g++){var f={id:c[g].config,playerCount:c[g].playerCount,list:[c[g].configMap["狼人"]+"狼人",c[g].configMap["平民"]+"平民",""]};for(var e in c[g].configMap){if(e!=="狼人"&&e!=="平民"){f.list[2]+=e+" "}}h.push(f)}a.combinats[0].content.combination=h}}};global.ajax(b)},getAllIdentity:function(){var a=this;var b={url:"game/play/getAllIdentity",data:{},success:function(g){if(g.status.code==="OK"){var e={};for(var c in g.data){for(var f=0;f<g.data[c].length;f++){if(g.data[c][f].name==="平民"){if(!e.pingmin){e.pingmin=[]}e.pingmin.push({id:g.data[c][f].id,name:g.data[c][f].name,select:3})}else{if(g.data[c][f].name==="狼人"){if(!e.langren){e.langren=[]}e.langren.push({id:g.data[c][f].id,name:g.data[c][f].name,select:3})}else{if(!e[c]){e[c]=[]}e[c].push({id:g.data[c][f].id,name:g.data[c][f].name,select:0})}}}}a.combinats[1].content.identity=e;a.setTotal()}}};global.ajax(b)},chooseType:function(){var a=this;a.flow=1;a.comType=parseInt(event.currentTarget.getAttribute("typeid"))},chooseBaseCom:function(){var a=this;a.flow=2;a.postData.config={};a.postData.combinationId=parseInt(event.currentTarget.getAttribute("typeid"));a.postData.playerCount=event.currentTarget.getAttribute("playercount")},toggle:function(b){var a=this;b.select=!b.select;a.setTotal()},add:function(b){var a=this;b.select++;a.setTotal()},sub:function(b){var a=this;if(b.select>0){b.select--;a.setTotal()}},setTotal:function(){var a=this;var e=0;var d=0;for(var b in a.combinats[1].content.identity){for(var c=0;c<a.combinats[1].content.identity[b].length;c++){d=a.combinats[1].content.identity[b][c].select;d=d||0;e+=d}}a.combinats[1].content.total=e},addCombination:function(){var a=this;var f=a.combinats[1].content;if(f.min<=f.total&&f.total<=f.max){var c={};for(var b in f.identity){for(var d=0;d<f.identity[b].length;d++){var e=f.identity[b][d].select;e=e||0;if(e){c[f.identity[b][d].id]=e}}}a.postData=$.extend({},a.postData,{combinationId:null,playerCount:f.total,config:c});a.flow=2}else{global.pop_tips("游戏人数请在"+f.min+"和"+f.max+"之间")}},chooseSelfs:function(){var a=this;a.flow=3;a.postData.gameModule=parseInt(event.currentTarget.getAttribute("typeid"))},chooseVictory:function(){var a=this;a.flow=4;a.postData.type=parseInt(event.currentTarget.getAttribute("typeid"));a.addScreeningByUser()},addScreeningByUser:function(){var a=this;var b;if(global.urlHash().event==="modify"){a.postData.screeningId=parseInt(global.urlHash().screeningId);b={url:"game/play/updateScreeningByUser",data:a.postData,success:function(e){var c="";callback=function(){global.router("game.html?boxId="+a.boxId+"&gameNumber="+a.gameNumber)};if(e.status.code==="OK"){c="修改成功"}else{if(e.status.retcode===1001){c=e.status.msg}else{c=e.status.msg;callback=function(){}}}global.pop_tips(c,callback)}}}else{a.postData.boxId=a.boxId;b={url:"game/play/addScreeningByUser",data:a.postData,success:function(e){var c="";callback=function(){global.router("game.html?boxId="+a.boxId+"&gameNumber="+a.gameNumber)};if(e.status.code==="OK"){c="设置成功"}else{if(e.status.retcode===1001){c=e.status.msg}else{c=e.status.msg;callback=function(){}}}global.pop_tips(c,callback)}}}global.ajax(b)}}});