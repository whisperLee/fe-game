<!DOCTYPE html>
<!--forbidden operators-->
<!--<html><head><title></title></head></body></html>-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta itemprop="name" content="腾讯新闻"/>
<meta itemprop="image" content="http://mat1.gtimg.com/news/2017/zt/htfc/share.jpg" />
<meta name="description" itemprop="description" content="腾讯新闻" />
<meta name="Keywords" content="腾讯新闻,腾讯网,QQ,Tencent" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<meta name="format-detection"content="telephone=no">
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<link rel="stylesheet" type="text/css" href="../css/global.css" />
<link rel="stylesheet" type="text/css" href="../css/game.css" />
<title>腾讯新闻</title>
<style>
  .messageCenter{position: absolute; left:20%; padding-top: 20%; top:1%; width: 60%; height:auto; display: none;}
  .messageCenter .message{background: rgba(26,188,156,0.8); color: #fff; width:100%; padding: .1rem; font-size: .14rem; box-sizing: border-box; border-radius: 5px;}
  .messageCenter .message h3{font-size: .16rem; }

  .user-list li {
    position: absolute;
    -webkit-transform-origin: center center;
    opacity: 0;
}
 .user-list li .head {
    position: relative;
    
}
.user-list .user {
    position: relative;
    width:100%;
    height:100%;
    -webkit-transform-origin: center center;
    opacity: 1;
}

.user.status .level{opacity: 0.8;}
.user.status .head img{visibility: hidden; }
.user.status .level .inner:before{background-image: url(../image/level/0.png)}
.user .level .inner .num{background-image: url(../image/level/0_1_0.png);}
/*死亡*/
.user.dead .head{background-image: url(../image/dead.png);}
/*禁言*/
.user.shutup .head{background-image: url(../image/dead.png);}
/*白痴翻牌*/
.user.idiot .head{background-image: url(../image/dead.png);}
/*白痴超时死亡*/
.user.idiot_timeout .head{background-image: url(../image/dead.png);}
/*殉情*/
.user.love_dead .head{background-image: url(../image/dead.png);}
/*放逐*/
.user.exile .head{background-image: url(../image/dead.png);}
/*开枪带走*/
.user.shoot .head{background-image: url(../image/dead.png);}
/*自爆*/
.user.self_destruct .head{background-image: url(../image/dead.png);}
/*炸弹人   炸弹上面画个眼睛嘴*/
.user.Bomberman .head{background-image: url(../image/dead.png);}

</style>
<meta name="author" content="lynnenie"/>
</head>
<body>
<div class="main night" id="before">
    <h2 class="readyTitle">等待进入游戏...</h2>
    <ul class="user-list">
      <li>
        <div num="1" class="user status dead">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status shutup">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status idiot">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status love_dead">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status exile">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status shoot">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status self_destruct">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status Bomberman">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user status idiot_timeout">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
      <li>
        <div num="1" class="user">
          <div class="level level1">
            <div class="inner">
              <div class="head"><img src="../image/head.png"></div>
              <i class="star star1"></i>
              <div class="num num1"></div>
            </div>
          </div>
        </div>
      </li>
    </ul>
    <a class="btn start" v-on:click="startGame">开始游戏</a>
    <div class="messageCenter">
      <div class="top">第<span class="days">1</span>天<span class="isnight">白天</span></div>
      <div class="message">天黑请闭眼</div>
      <div class="result">竞选警长的玩家有：【1】【5】【9】</div>
    </div>
</div>
<script type="application/javascript" src="../../js/zepto.min.js"></script>
<script type="application/javascript" src="../../js/vue.js"></script>
<script type="application/javascript" src="../../js/velocity.min.js"></script>
<script type="application/javascript" src="../../js/sockjs.min.js"></script>
<script type="application/javascript" src="../../js/stomp.js"></script>

<script type="application/javascript" src="../js/global.js"></script>
<script type="application/javascript" src="../js/websocket.js"></script>
<script type="application/javascript" src="../js/component.js"></script>
<script type="application/javascript" src="../js/animate.js"></script>
    <script>
    $(function(){
      var game = {
        position:{},
        user:{},
        init:function(){
          var _this = this;
          _this.userInit();
          this.active();
        },
        userInit:function(){
          var _self = this;
          var total = 12
            var col = 4
            var row = Math.ceil(total / col)
            var userW = $(window).width() / col
            $('.user-list').css({
                'height': row * userW
            })
            $('.user-list li').each(function (idx) {
                $(this).css({
                    width: userW,
                    height: userW,
                    opacity: 1,
                    left: parseInt(idx % col) * userW,
                    top: parseInt(idx / col) * userW
                })
            })
        },
        startGame:function(){
          var _self = this;
          var total = 12
            var col = 5
            var row = parseInt((total - 4) / 2) + 1
            var center_user = total - row * 2
            var width = height = $(window).width() / col
            var styles = _self.returnUserStyle(total,row,col,width,height,center_user)

            $('.readyTitle').velocity({
                height: 0,
                opacity: 0
            }, {
                'duration': 500,
                'complete': function () {
                    $('.readyTitle').remove()
                }
            })
            $('.queueBtns').velocity({
                height: 0,
                opacity: 0
            }, {
                'duration': 100,
                'complete': function () {
                    $('.queueBtns').remove()
                }
            })

            $('.user-list').velocity({
                height: row * width
            }, 500)

            $('.user-list li').each(function (idx) {
                var f = $(this)
                var data = styles.style[idx]
                data.width = data.height = width
                data.opacity = 1
                f.velocity(data, {
                    'duration': 800,
                    'delay': idx * 50
                })
                f.addClass(styles.className[idx])
            })
        },
        returnUserStyle:function(total,row,col,width,height,center_user){
          var _self =this;
          var style = []
            var className = []
            for (var i = 1; i <= total; i++) {
                if (i <= row) { // 左边
                    style.push({
                        left: 0,
                        top: (row - i) * height
                    })
                    className.push('left')
                } else if (i > row + center_user) { // 右边
                    style.push({
                        left: (col - 1) * width,
                        top: (i - row - center_user - 1) * height
                    })
                    className.push('right')
                } else {
                    style.push({
                        left: (i - row) * (1 + (col - center_user - 2) / (center_user + 1)) * width,
                        top: 0
                    })
                    className.push('center')
                }
            }
            console.log(style)
            return {"style":style,"className":className}
        },
        showMessage:function(title,info,time){
          var el = $('<div class="message"><h3>'+title+'</h3><p>'+info+'</p></div>')
       
          $('.messageCenter').append(el).show()

          animate.messageEnter(el,time)
          
        },
        active:function(){
          var _this = this;
          $(".start").off().on("click",function(){
            _this.startGame();
            var m = {
              "eventName":"猎人上膛",
              "eventDesc":"猎人,如果你天亮后死亡,你'可以'开枪.",
              "chooseCount":0,
              "unifyFlag":false,
              "eventSurplusTime":6
            }
            _this.showMessage(m.eventName,m.eventDesc,m.eventSurplusTime)
          });
          //身份
          $(".shenfen").off().on("click",function(){
            var f = $(this);
            var initStyle={
              width:f.width(),
              height:f.height(),
              left:f.offset().left,
              top:f.offset().top,
              display:"block",
            };
            animate.layerEnter($(".layerShenfen"),initStyle,function(){});
          
          });
          $(".layerShenfen .btn").off().on("click",function(){
            var el = $(".layerShenfen");
            animate.layerOuter(el,function(){el.css({display:"none"})});
          });
          //桌长
          $(".zhuozhang").off().on("click",function(){
            var f = $(this);
            var initStyle={
              width:f.width(),
              height:f.height(),
              left:f.offset().left,
              top:f.offset().top,
              display:"block"
            };
            animate.layerEnter($(".layerZhuozhang"),initStyle,function(){});
          
          });
          $(".layerZhuozhang .btn").off().on("click",function(){
            var el = $(".layerZhuozhang");
            animate.layerOuter(el,function(){el.hide();});
          });

          $(".other").off().on("click",function(){
            var initStyle={
              width:0,
              height:0,
              left:"50%",
              top:"50%",
              display:"block"
            };
            animate.layerEnter($(".layerOther"),initStyle,function(){});
          });

          $(".layerOther .btn").off().on("click",function(){
            var el = $(".layerOther");
            animate.layerOuter(el,function(){el.hide();});
          });
          $(".mess").off().on("click",function(){
            var initStyle={
              display:"block"
            };
            //var el = $(".messesBox .content");
            var mess = $('<div class="content">我就是看看</div>');
            $(".messesBox").append(mess);
            animate.messageEnter(mess,initStyle,function(){
              setTimeout(function(){animate.messageOuter(mess,function(){mess.hide();})},3000)
            });
          });
          
          var shenfen_flow = 0;
          var $shenfen;
          $(".layerShenfen .content").off().on("touchstart",function(){
            $shenfen = $(this);
            if(shenfen_flow == 0){//必须动画执行完成后才能开始查看动画
              $shenfen.velocity(
                {rotateY: "90deg"},
                {
                  duration:400,
                  delay:300,
                  easing: "ease-in-out",
                  complete:function(){
                    shenfen_flow = 1;
                    console.log(shenfen_flow);
                    $shenfen.addClass("active");
                  }
                }
              ).velocity(
                {rotateY: "0deg"},
                {
                  duration:300,
                  easing: "ease-in-out",
                  complete:function(){
                    shenfen_flow=2;
                    console.log(shenfen_flow);
                  }
                }
              );
            }
            
          }).on("touchend",function(){
            $shenfen = $(this);
            if(shenfen_flow==2){//如果已经查看完身份，则正常执行回返动画
              $shenfen.velocity(
                { rotateY: "90deg"},
                {
                  duration:300,
                  easing: "ease-in-out",
                  complete:function(){
                    $shenfen.removeClass("active");
                    shenfen_flow=3;
                    console.log(shenfen_flow);
                  }
                }
              )
              .velocity(
                { rotateY: "0deg"},
                {
                  duration:300,
                  easing: "ease-in-out",
                  complete:function(){
                    shenfen_flow=0;
                    console.log(shenfen_flow);
                  }
                }
              );
            }else{//查看过程中终止查看
              $shenfen.velocity("stop", true);//停止正在进行的一切动画
              if(shenfen_flow==0){//如果还没到90度，则直接翻转回来
                $shenfen.velocity(
                  {rotateY: "0deg"},
                  {
                    duration:300,
                    easing: "ease-in-out",
                    complete:function(){
                      shenfen_flow=0;
                      console.log(shenfen_flow);
                    }
                  }
                );
              }else if(shenfen_flow==1){//过了90度，查看到一部分身份牌时，需要先回转到90度，并将身份样式移除，在回转到0度
                $shenfen.velocity(
                  {rotateY: "90deg"},
                  {
                    duration:300,
                    easing: "ease-in-out",
                    complete:function(){
                      $shenfen.removeClass("active");
                      shenfen_flow=3;
                      console.log(shenfen_flow);
                    }
                  }
                )
                .velocity(
                  { rotateY: "0deg"},
                  {
                    duration:300,
                    easing: "ease-in-out",
                    complete:function(){
                      shenfen_flow=0;
                      console.log(shenfen_flow);
                    }
                
                  }
                );
              }
            }
            
          });


        }
      };
   
      game.init();
    }); 
    </script>
</body>
</html>
<!--<html><head><title></title></head></body></html>-->
