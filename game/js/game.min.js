Vue.component("user",component.user);Vue.component("qiangshenfen",component.qiangshenfen);Vue.component("identitylayer",component.identitylayer);new Vue({el:"#game",data:{tips:0,queueFlow:0,gameEvent:"",screeningId:0,leaderFlag:0,users:[],message:"123",shenfens:[{cost:10,identityId:2,type:"langren",name:"狼人"},{cost:10,identityId:1,type:"pingmin",name:"平民"},{cost:10,identityId:3,type:"shouwei",name:"守卫"}],mineIdentity:{identityId:3,type:"shouwei",name:"守卫"},userSet:{},mine:{},vote:{}},created:function(){var a=this;console.log("页面开始:"+new Date());a.sit()},methods:{sit:function(){var a=this;a.boxId=global.urlHash().boxId||0;a.gameNumber=global.urlHash().gameNumber||0;var b={url:"game/play/sit",data:{boxId:a.boxId,gameNumber:a.gameNumber},success:function(c){if(c.status.code==="OK"){console.log("入座成功:"+new Date());a.message="入座成功";a.queueFlow=1;a.leaderFlag=c.data.leaderFlag;a.screeningId=c.data.screeningId;a.userId=c.data.userId;if(c.data.leaderFlag&&!c.data.screeningId){global.router("gameSet.html?boxId="+a.boxId+"&gameNumber="+a.gameNumber+"&event=add")}else{a.connectWebScoket()}}else{if(c.status.retcode===1003){global.pop_tips("您还没有签到， 稍后为您跳转到签到页面",function(){global.router("check.html")})}else{if(c.status.retcode===1008){global.pop_tips("请打开微信扫一扫功能， 扫描座位上二维码， 即可开始游戏",function(){global.saoyisao()})}else{global.pop_tips(c.status.msg)}}}}};global.ajax(b);console.log("入座")},quitSeat:function(){var a=this;var b={url:"game/play/quitSeat",data:{},success:function(c){if(c.status.code==="OK"){global.pop_tips("退座成功",function(){global.saoyisao()})}else{global.pop_tips(c.status.msg)}}};global.ajax(b)},modifyGameSet:function(){var a=this;global.router("gameSet.html?boxId="+a.boxId+"&gameNumber="+a.gameNumber+"&screeningId="+a.screeningId+"&event=modify")},connectWebScoket:function(){var a=this;console.log("websocket开始:"+new Date());websocket.connect(a,a.boxId,a.userId,a.socketCallback)},socketCallback:function(b){var a=this;console.log("得到返回数据:"+new Date());var c=JSON.parse(b.body);a.gameEvent=c.msgType;a.doGameEvent(a.gameEvent,c)},doGameEvent:function(b,c){var a=this;if(b==="QUEUE"){a.setUser(c);setTimeout(function(){a.setUserQueueStyle()},10)}if(b==="CUR_GAME_STATUS"){a.setUser(c);setTimeout(function(){a.setUserGameStyle()},10);a.mine=c.personalInfo;a.mineIdentity=c.personalInfo;if(c.eventInfo.eventType=="EVENT_IDENTITY_CONFIRMATION"){a.doGameEvent(c.eventInfo.eventType,c)}}if(b==="EVENT_IDENTITY_PURCHASE"){a.shenfens=c.identityInfoList}if(b==="EVENT_IDENTITY_CONFIRMATION"){a.mineIdentity=c.personalInfo;a.showSF()}},showSF:function(){if($(".qiang").length>0){$(".shenfens li").each(function(c){var d=$(this);d.velocity({translateX:[(1-c)*100+"%",0],scale:0,opacity:0},{duration:400,easing:"ease-in-out",complete:function(){$(".qiang").hide()}})});var a={width:0,height:0,left:"50%",top:"50%",display:"block",opacity:1}}else{var b=$(".mine .btn.identity");if($(".mine .btn.identity").length>0){var a={width:b.width(),height:b.height(),left:b.offset().left,top:b.offset().top,display:"block",opacity:0}}else{var a={width:0,height:0,left:0,top:$(".main").height(),display:"block",opacity:0}}}animate.sfLayerInter($(".layerShenfen"),a,function(){})},setUser:function(f){var a=this;a.users=[];var e=(f.screeningInfo&&f.screeningInfo.playerCount)||15;for(var b=0;b<e;b++){a.users.push({userId:"10"+b,number:b+1,headImgUrl:staticUrl+"/image/head.png"})}if(f.userInfoList&&f.userInfoList.length>0){for(var c=0;c<f.userInfoList.length;c++){if(typeof(f.userInfoList[c].headImgUrl)==="undefined"||f.userInfoList[c].headImgUrl===""){f.userInfoList[c].headImgUrl=staticUrl+"/image/head.png"}a.users[f.userInfoList[c].number-1]=f.userInfoList[c]}if(a.event==="QUEUE"&&f.userInfoList.length===e){a.queueFlow=2}else{a.queueFlow=1}}},setUserQueueStyle:function(){var a=this;var d=a.users.length;var b=4;var e=Math.ceil(d/b);var c=$(window).width()/b;$(".user-list").css({height:e*c});$(".user-list .user").each(function(f){$(this).css({width:c,height:c,opacity:1,left:parseInt(f%b)*c,top:parseInt(f/b)*c})})},setUserGameStyle:function(){var a=this;var f=a.users.length;var b=5;var g=parseInt((f-4)/2)+1;var c=f-g*2;var e=height=$(window).width()/b;var d=a.returnUserStyle(f,g,b,e,height,c);$(".readyTitle").velocity({height:0,opacity:0},{duration:500,complete:function(){$(".readyTitle").remove()}});$(".queueBtns").velocity({height:0,opacity:0},{duration:100,complete:function(){$(".queueBtns").remove()}});$(".user-list").velocity({height:g*e},500);$(".user-list .user").each(function(h){var j=$(this);var i=d[h];i.width=i.height=e;i.opacity=1;j.velocity(i,{duration:800,delay:h*50})})},startGame:function(){var a=this;websocket.userStartGame();a.setUserGameStyle()},returnUserStyle:function(g,j,d,b,h,c){var f=this;var a=[];for(var e=1;e<=g;e++){if(e<=j){a.push({left:0,top:(j-e)*h})}else{if(e>j+c){a.push({left:(d-1)*b,top:(e-j-c-1)*h})}else{a.push({left:(e-j)*(1+(d-c-2)/(c+1))*b,top:0})}}}console.log(a);return a},userClick:function(b){var a=this;console.log(b)}}});